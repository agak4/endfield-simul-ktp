# 엔드필드 계산기 업데이트 로그

## 2026-02-22 (적의 저항 및 데미지 로직 개선)

### 1. 적의 저항 설정 기능 추가
- **UI 추가**: 대시보드 타일에 적의 저항을 설정할 수 있는 버튼(A, B, C, D)을 추가했습니다. (각각 70, 50, 20, 0)
- **로직 구현**: `state.enemyResistance` 변수를 추가하고, 데미지 계산 시 기본 저항값으로 사용하도록 수정했습니다.
- **시각화**: 저항 값이 양수일 때 피해 배율을 빨간색으로 표시하여 페널티를 강조했습니다.

### 2. 오리지늄 아츠 강도 로직 수정
- **문제 해결**: 오리지늄 아츠 강도가 모든 데미지에 곱해지는 오류를 수정했습니다.
- **변경 사항**: 스킬 자체 데미지에는 적용되지 않고, 물리 이상(강타, 띄우기 등) 및 아츠 이상 데미지에만 곱해지도록 제한했습니다.
- **로그 개선**: 오리지늄 아츠 강도 로그에 "(이상 데미지에 적용)" 문구를 추가하여 명확히 했습니다.

### 3. 무기 비교 로직 개선
- **문제 해결 1 (전역 상태 오염)**: 무기 비교 시 현재 설정된 옵션(저항, 디버프, 비활성화된 효과 등)이 제대로 반영되지 않거나, 비교 과정에서 전역 상태가 오염되는 문제를 해결했습니다.
  - **구현**: `renderWeaponComparison` 함수에서 전역 `state`를 깊은 복사(`JSON.parse(JSON.stringify(state))`)하여 독립적인 계산 환경을 구축했습니다.
- **문제 해결 2 (중첩 상태 유지)**: 무기 비교 시 오퍼레이터 재능 스택 등이 강제로 최대화되는 문제를 해결했습니다.
  - **구현**: `calculateDamage` 호출 시 `forceMaxStack` 인자를 `false`로 설정하여 현재 UI 설정을 존중하도록 변경했습니다.
- **문제 해결 3 (특성 활성화)**: 비교 대상 무기의 특성이 이전에 끈 설정 때문에 비활성화된 채로 비교되는 문제를 해결했습니다. 동시에 서브 무기 등의 특성 설정은 유지하여 동일 무기 비교 시 데미지 불일치를 방지했습니다.
  - **구현**: 비교 루프 내에서 `tempState.disabledEffects`를 필터링할 때, 비교 대상 무기의 이름으로 시작하는 특성 UID만 선택적으로 제거하도록 로직을 정교화했습니다.
- **문제 해결 4 (UI 렌더링)**: 무기 비교 바(`comp-bar`)의 너비 계산 로직을 개선하여 가장 강력한 무기를 기준으로 꽉 채우도록 변경하고, 비정상적인 값으로 인한 오류를 방지했습니다.
  - **구현**: 기준값 변경(현재 무기 제외 최대값), 비율 제한(0~1), 소수점 처리.
- **문제 해결 5 (애니메이션)**: 무기 순서 변경 시 FLIP 애니메이션이 작동하지 않는 문제를 해결했습니다.
  - **구현**: 요소 식별 키를 `innerText`에서 불변 속성인 `data-weapon-name`으로 변경하여 매칭 정확도를 높였습니다.
