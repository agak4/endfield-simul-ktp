<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>엔드필드 세팅 시뮬레이터</title>
    <link rel="stylesheet" href="style.css">
</head>

<body>
    <!-- 상단 헤더 -->
    <header class="app-header">
        <div class="header-content">
            <div class="header-logo">
                <span class="logo-icon">✦</span>
                <h1 class="header-title">엔드필드 세팅 시뮬레이터</h1>
            </div>
            <div class="header-nav">
                <span class="nav-item active">시뮬레이터</span>
                <span class="nav-item">가이드</span>
            </div>
        </div>
    </header>

    <div class="container">
        <!-- [왼쪽 패널] 메인 오퍼레이터 설정 -->
        <section class="panel left-panel">
            <h2>메인 오퍼레이터</h2>
            <div class="main-op-row">
                <div class="main-op-left">
                    <div id="main-op-image-container" class="op-image-container">
                        <img id="main-op-image" src="" alt="오퍼레이터 이미지">
                    </div>
                </div>
                <div class="main-op-right">
                    <div class="control-row">
                        <select id="main-op-select" class="u-display-none"></select>
                        <button id="main-op-select-btn" class="visual-select-btn btn-select">선택하세요</button>
                    </div>
                    <div class="control-row potency-row">
                        <label>잠재효과</label>
                        <div class="potency-group" id="main-op-pot-group"></div>
                        <input type="hidden" id="main-op-pot" value="0">
                    </div>
                </div>
            </div>

            <div class="wep-row">
                <div class="wep-left">
                    <div id="main-wep-image-container" class="op-image-container wep-image-container">
                        <img id="main-wep-image" src="" alt="무기 이미지">
                    </div>
                </div>
                <div class="wep-right">
                    <div class="control-row">
                        <select id="main-wep-select" class="u-display-none"></select>
                        <button id="main-wep-select-btn" class="visual-select-btn btn-select">선택하세요</button>
                    </div>
                    <div class="control-row potency-row">
                        <label>잠재효과</label>
                        <div class="u-flex-center-wrap">
                            <div class="potency-group" id="main-wep-pot-group"></div>
                            <input type="checkbox" id="main-wep-state" class="hidden-checkbox">
                        </div>
                        <input type="hidden" id="main-wep-pot" value="0">
                    </div>
                </div>
            </div>

            <!-- 장비 슬롯 (Flex Layout) -->
            <div id="main-gear-slots" class="gear-flex-row">
                <div class="gear-slot" data-slot="gloves">
                    <div class="gear-image-container op-image-container"
                        onclick="openGearSidebar('gear-gloves-select', 'gloves')">
                        <img id="gear-gloves-image" src="" alt="글러브">
                    </div>
                    <input type="hidden" id="gear-gloves-select" value="">
                    <div class="forge-toggle-wrapper">
                        <input type="checkbox" id="gear-gloves-forge" class="hidden-checkbox">
                    </div>
                </div>
                <div class="gear-slot" data-slot="armor">
                    <div class="gear-image-container op-image-container"
                        onclick="openGearSidebar('gear-armor-select', 'armor')">
                        <img id="gear-armor-image" src="" alt="방어구">
                    </div>
                    <input type="hidden" id="gear-armor-select" value="">
                    <div class="forge-toggle-wrapper">
                        <input type="checkbox" id="gear-armor-forge" class="hidden-checkbox">
                    </div>
                </div>
                <div class="gear-slot" data-slot="kit1">
                    <div class="gear-image-container op-image-container"
                        onclick="openGearSidebar('gear-kit1-select', 'kit')">
                        <img id="gear-kit1-image" src="" alt="부품">
                    </div>
                    <input type="hidden" id="gear-kit1-select" value="">
                    <div class="forge-toggle-wrapper">
                        <input type="checkbox" id="gear-kit1-forge" class="hidden-checkbox">
                    </div>
                </div>
                <div class="gear-slot" data-slot="kit2">
                    <div class="gear-image-container op-image-container"
                        onclick="openGearSidebar('gear-kit2-select', 'kit')">
                        <img id="gear-kit2-image" src="" alt="부품">
                    </div>
                    <input type="hidden" id="gear-kit2-select" value="">
                    <div class="forge-toggle-wrapper">
                        <input type="checkbox" id="gear-kit2-forge" class="hidden-checkbox">
                    </div>
                </div>
            </div>

            <div class="u-flex-row u-gap-15">
                <div id="main-active-set" class="active-set-container u-flex-1"></div>
                <div class="control-group u-flex-1" id="main-forge-wrapper">
                    <input type="checkbox" id="main-gear-forge" class="hidden-checkbox">
                </div>
            </div>
        </section>

        <!-- 장비 선택 사이드바 (Hidden) -->
        <div id="gear-sidebar" class="sidebar">
            <div class="sidebar-header">
                <h3>장비 선택</h3>
                <button class="sidebar-close" onclick="closeGearSidebar()">&times;</button>
            </div>
            <div class="sidebar-content">
                <div id="gear-sidebar-grid" class="gear-sidebar-grid"></div>
            </div>
        </div>

        <!-- [중앙 패널] 서브 오퍼레이터 -->
        <section class="panel center-panel">
            <h2>서브 오퍼레이터 (지원)</h2>
            <div id="sub-ops-container">
                <!-- Sub Op 1~3은 JS로 제어되나 HTML 구조는 유지 -->
                <div class="sub-op-card" id="sub-op-card-0">
                    <div class="sub-op-header" onclick="toggleSubOp(0)">
                        <span>서브 오퍼레이터 1</span>
                        <span id="sub-0-summary" class="sub-op-summary-text"></span>
                        <span class="toggle-icon">▼</span>
                    </div>
                    <div class="sub-op-content" id="sub-op-content-0">
                        <div class="sub-char-row">
                            <div class="sub-char-left">
                                <div class="op-image-container"><img id="sub-0-image" src="" alt="서브1"></div>
                            </div>
                            <div class="sub-char-right">
                                <div class="control-row">
                                    <select id="sub-0-op" class="u-display-none"></select>
                                    <button id="sub-0-op-btn" class="visual-select-btn btn-select">선택하세요</button>
                                </div>
                                <div class="control-row potency-row">
                                    <label>잠재효과</label>
                                    <div class="potency-group" id="sub-0-pot-group"></div>
                                    <input type="hidden" id="sub-0-pot" value="0">
                                </div>
                            </div>
                        </div>
                        <div class="sub-wep-row">
                            <div class="sub-wep-left">
                                <div class="op-image-container"><img id="sub-0-wep-image" src="" alt="무기"></div>
                            </div>
                            <div class="sub-wep-right">
                                <div class="control-row">
                                    <select id="sub-0-wep" class="u-display-none"></select>
                                    <button id="sub-0-wep-btn" class="visual-select-btn btn-select">선택하세요</button>
                                </div>
                                <div class="control-row potency-row">
                                    <label>잠재효과</label>
                                    <div class="u-flex-center-wrap">
                                        <div class="potency-group" id="sub-0-wep-pot-group"></div>
                                        <input type="checkbox" id="sub-0-wep-state" class="hidden-checkbox">
                                    </div>
                                    <input type="hidden" id="sub-0-wep-pot" value="0">
                                </div>
                            </div>
                        </div>
                        <div class="sub-set-row" style="margin-top:10px">
                            <label>장비 세트</label>
                            <select id="sub-0-set" class="visual-select-btn btn-select">
                                <option value="">(세트 없음)</option>
                            </select>
                        </div>
                    </div>
                </div>

                <!-- Sub Op 2 (생략된 구조 복구) -->
                <div class="sub-op-card" id="sub-op-card-1">
                    <div class="sub-op-header" onclick="toggleSubOp(1)">
                        <span>서브 오퍼레이터 2</span>
                        <span id="sub-1-summary" class="sub-op-summary-text"></span>
                        <span class="toggle-icon">▼</span>
                    </div>
                    <div class="sub-op-content" id="sub-op-content-1">
                        <div class="sub-char-row">
                            <div class="sub-char-left">
                                <div class="op-image-container"><img id="sub-1-image" src="" alt="서브2"></div>
                            </div>
                            <div class="sub-char-right">
                                <div class="control-row">
                                    <select id="sub-1-op" class="u-display-none"></select>
                                    <button id="sub-1-op-btn" class="visual-select-btn btn-select">선택하세요</button>
                                </div>
                                <div class="control-row potency-row">
                                    <label>잠재효과</label>
                                    <div class="potency-group" id="sub-1-pot-group"></div>
                                    <input type="hidden" id="sub-1-pot" value="0">
                                </div>
                            </div>
                        </div>
                        <div class="sub-wep-row">
                            <div class="sub-wep-left">
                                <div class="op-image-container"><img id="sub-1-wep-image" src="" alt="무기"></div>
                            </div>
                            <div class="sub-wep-right">
                                <div class="control-row">
                                    <select id="sub-1-wep" class="u-display-none"></select>
                                    <button id="sub-1-wep-btn" class="visual-select-btn btn-select">선택하세요</button>
                                </div>
                                <div class="control-row potency-row">
                                    <label>잠재효과</label>
                                    <div class="u-flex-center-wrap">
                                        <div class="potency-group" id="sub-1-wep-pot-group"></div>
                                        <input type="checkbox" id="sub-1-wep-state" class="hidden-checkbox">
                                    </div>
                                    <input type="hidden" id="sub-1-wep-pot" value="0">
                                </div>
                            </div>
                        </div>
                        <div class="sub-set-row u-mt-10">
                            <label>장비 세트</label>
                            <select id="sub-1-set" class="visual-select-btn btn-select">
                                <option value="">(세트 없음)</option>
                            </select>
                        </div>
                    </div>
                </div>

                <!-- Sub Op 3 (생략된 구조 복구) -->
                <div class="sub-op-card" id="sub-op-card-2">
                    <div class="sub-op-header" onclick="toggleSubOp(2)">
                        <span>서브 오퍼레이터 3</span>
                        <span id="sub-2-summary" class="sub-op-summary-text"></span>
                        <span class="toggle-icon">▼</span>
                    </div>
                    <div class="sub-op-content" id="sub-op-content-2">
                        <div class="sub-char-row">
                            <div class="sub-char-left">
                                <div class="op-image-container"><img id="sub-2-image" src="" alt="서브3"></div>
                            </div>
                            <div class="sub-char-right">
                                <div class="control-row">
                                    <select id="sub-2-op" class="u-display-none"></select>
                                    <button id="sub-2-op-btn" class="visual-select-btn btn-select">선택하세요</button>
                                </div>
                                <div class="control-row potency-row">
                                    <label>잠재효과</label>
                                    <div class="potency-group" id="sub-2-pot-group"></div>
                                    <input type="hidden" id="sub-2-pot" value="0">
                                </div>
                            </div>
                        </div>
                        <div class="sub-wep-row">
                            <div class="sub-wep-left">
                                <div class="op-image-container"><img id="sub-2-wep-image" src="" alt="무기"></div>
                            </div>
                            <div class="sub-wep-right">
                                <div class="control-row">
                                    <select id="sub-2-wep" class="u-display-none"></select>
                                    <button id="sub-2-wep-btn" class="visual-select-btn btn-select">선택하세요</button>
                                </div>
                                <div class="control-row potency-row">
                                    <label>잠재효과</label>
                                    <div class="u-flex-center-wrap">
                                        <div class="potency-group" id="sub-2-wep-pot-group"></div>
                                        <input type="checkbox" id="sub-2-wep-state" class="hidden-checkbox">
                                    </div>
                                    <input type="hidden" id="sub-2-wep-pot" value="0">
                                </div>
                            </div>
                        </div>
                        <div class="sub-set-row u-mt-10">
                            <label>장비 세트</label>
                            <select id="sub-2-set" class="visual-select-btn btn-select">
                                <option value="">(세트 없음)</option>
                            </select>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- [오른쪽 패널] 대시보드 -->
        <section class="panel right-panel">
            <h2>전투 분석 대시보드</h2>
            <div class="result-box total-dmg-box">
                <h3>최종 계산값</h3>
                <span id="final-damage">0</span>
            </div>
            <div class="dashboard-grid">
                <div class="tile">
                    <h4>공격력</h4>
                    <div class="tile-main-stat-row">
                        <span id="stat-atk">0</span>
                        <div class="tile-sub-stats">
                            <div class="sub-stat-item">
                                <label>공격력%</label>
                                <span id="stat-atk-inc">0%</span>
                            </div>
                            <div class="sub-stat-item">
                                <label id="label-main-stat">힘</label>
                                <span id="stat-main-val">0</span>
                            </div>
                            <div class="sub-stat-item">
                                <label id="label-sub-stat">민첩</label>
                                <span id="stat-sub-val">0</span>
                            </div>
                        </div>
                    </div>
                    <ul id="list-atk" class="detail-list"></ul>
                </div>
                <div class="tile">
                    <h4>치명타 기대값</h4>
                    <div class="tile-main-stat-row">
                        <span id="stat-crit">0</span>
                        <div class="tile-sub-stats">
                            <div class="sub-stat-item">
                                <label>치명타 확률</label>
                                <span id="val-crit-rate">0%</span>
                            </div>
                            <div class="sub-stat-item">
                                <label>치명타 피해</label>
                                <span id="val-crit-dmg">0%</span>
                            </div>
                        </div>
                    </div>
                    <ul id="list-crit" class="detail-list"></ul>
                </div>
                <div class="tile">
                    <h4>주는 피해</h4>
                    <span id="stat-dmg-inc">0%</span>
                    <ul id="list-dmg-inc" class="detail-list"></ul>
                </div>
                <div class="tile">
                    <h4>증폭</h4>
                    <span id="stat-amp">0%</span>
                    <ul id="list-amp" class="detail-list"></ul>
                </div>
                <div class="tile">
                    <h4>적이 받는 피해</h4>
                    <span id="stat-taken">0%</span>
                    <ul id="list-taken" class="detail-list"></ul>
                </div>
                <div class="tile">
                    <h4>취약</h4>
                    <span id="stat-vuln">0%</span>
                    <ul id="list-vuln" class="detail-list"></ul>
                </div>
                <div class="tile">
                    <div class="tile-header-row">
                        <h4>불균형</h4>
                        <div class="tile-ctrl-group">
                            <input type="checkbox" id="enemy-unbalanced" class="hidden-checkbox">
                            <button id="enemy-unbalanced-toggle" class="toggle-btn enemy-toggle-btn">OFF</button>
                        </div>
                    </div>
                    <span id="stat-unbal">0%</span>
                    <ul id="list-unbal" class="detail-list"></ul>
                </div>
                <div class="tile">
                    <h4>연타</h4>
                    <span id="stat-multihit">0</span>
                    <ul id="list-multihit" class="detail-list"></ul>
                </div>
                <div class="tile">
                    <h4>오리지늄 아츠 강도</h4>
                    <span id="stat-arts">0</span>
                    <ul id="list-arts" class="detail-list"></ul>
                </div>
            </div>

            <h3>무기 비교</h3>
            <div class="comparison-settings comp-settings-panel">
                <div class="comp-settings-header">
                    <span class="comp-settings-indicator"></span>
                    비교 대상 설정 (일괄 적용)
                </div>
                <div class="comp-settings-body">
                    <div class="control-row potency-row">
                        <label class="u-font-xsmall">무기 잠재</label>
                        <div class="potency-group" id="comp-wep-pot-group"></div>
                        <input type="hidden" id="comp-wep-pot" value="0">
                    </div>
                    <div class="u-flex-column-center">
                        <label class="u-font-xsmall">기질 여부</label>
                        <input type="checkbox" id="comp-wep-state" class="hidden-checkbox">
                    </div>
                </div>
            </div>
            <div id="weapon-comparison" class="comparison-list"></div>
        </section>
    </div>

    <!-- 오퍼레이터 선택 모달 -->
    <div id="op-selector-modal" class="modal-overlay">
        <div class="modal-content">
            <div class="modal-header">
                <span class="modal-header-title">오퍼레이터 선택</span>
                <button class="modal-close"
                    onclick="document.getElementById('op-selector-modal').classList.remove('open')">&times;</button>
            </div>
            <div class="modal-grid" id="op-modal-grid"></div>
        </div>
    </div>

    <!-- 무기 선택 모달 -->
    <div id="wep-selector-modal" class="modal-overlay">
        <div class="modal-content">
            <div class="modal-header">
                <span class="modal-header-title">무기 선택</span>
                <button class="modal-close"
                    onclick="document.getElementById('wep-selector-modal').classList.remove('open')">&times;</button>
            </div>
            <div class="modal-grid" id="wep-modal-grid"></div>
        </div>
    </div>

    <!-- 푸터 -->
    <footer class="app-footer">
        <div class="footer-content">
            <div class="footer-info">
                <span>Endfield Simulator</span>
                <span class="divider">|</span>
                <span>Powered by Antigravity</span>
            </div>
            <!-- <div class="footer-links">
                <span class="footer-link">Github</span>
                <span class="footer-link">Discord</span>
            </div> -->
        </div>
    </footer>

    <script src="data_operators.js"></script>
    <script src="data_weapons.js"></script>
    <script src="data_gear.js"></script>

    <!-- 툴팁 컨테이너 -->
    <div id="app-tooltip" class="app-tooltip" style="display: none;"></div>

    <script src="script.js"></script>
    <script src="ui.js"></script>
</body>

</html>